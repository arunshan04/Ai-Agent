import React, { useState, useEffect } from 'react';
import { Outlet } from 'react-router-dom';
import Sidebar from './Sidebar';
import { getTracks } from '../api/cveService';

const Layout = () => {
    const [tracks, setTracks] = useState([]);
    const [error, setError] = useState(null);
    const [sidebarOpen, setSidebarOpen] = useState(true); // Sidebar is pinned (open) by default

    useEffect(() => {
        getTracks()
            .then(data => {
                // Deduplicate tracks by name
                const uniqueTracks = Array.from(new Map(data.map(item => [item['name'], item])).values());
                setTracks(uniqueTracks);
            })
            .catch(err => setError("Could not fetch tracks. Is the backend server running?"));
    }, []);

    return (
        <div className="app-container">
            <Sidebar tracks={tracks} sidebarOpen={sidebarOpen} setSidebarOpen={setSidebarOpen} />
            <main className="main-content">
                {/* Toggle button is now hidden, sidebar auto-shows on hover */}
                {error ? <div className="error-message">{error}</div> : <Outlet />}
            </main>
        </div>
    );
};

export default Layout;